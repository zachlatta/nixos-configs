# -----------------------------------------------------
# Hyprland Config for mew
# Refer to the Hyprland wiki for all options:
# https://wiki.hyprland.org/Configuring/Variables/
# -----------------------------------------------------

# -----------------------------------------------------
# MONITORS
# See https://wiki.hyprland.org/Configuring/Monitors/
# -----------------------------------------------------
# monitor = name,resolution,position,scale
monitor = ,preferred,auto,1.5 # Auto-detect primary, use preferred res, auto position, 1.5 scale
# Example for specific monitor:
# monitor = DP-1,3840x2160@120,0x0,1.5
# monitor = eDP-1,1920x1080@60,auto,1

# -----------------------------------------------------
# ENVIRONMENT VARIABLES
# See https://wiki.hyprland.org/Configuring/Environment-variables/
# -----------------------------------------------------
# Some are set in NixOS config, these are session-specific for Hyprland
env = XCURSOR_SIZE,24
env = HYPRCURSOR_SIZE,24
# env = GDK_SCALE,1.5 # May conflict with per-monitor scaling or GTK settings in home.nix
# env = QT_SCALE_FACTOR,1.5
env = GTK_THEME,Breeze-Dark # Ensure this matches your home.nix GTK settings
env = QT_QPA_PLATFORMTHEME,qt5ct # Or qt6ct

# -----------------------------------------------------
# AUTOSTART APPS & SCRIPTS (exec-once)
# See https://wiki.hyprland.org/Configuring/Keywords/#executing
# -----------------------------------------------------
exec-once = dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP # For portals
exec-once = systemctl --user import-environment WAYLAND_DISPLAY XDG_CURRENT_DESKTOP # For systemd services
# exec-once = waybar # Managed by home-manager service in this setup
# exec-once = mako # Managed by home-manager service
# exec-once = hyprpaper # Managed by home-manager service
exec-once = wl-paste --watch cliphist store # Store clipboard history
exec-once = ~/.config/hypr/scripts/portal-fix.sh # If you need a portal fix script
exec-once = nm-applet --indicator # NetworkManager applet
# exec-once = blueman-applet # Bluetooth applet if needed

# -----------------------------------------------------
# INPUT - KEYBOARDS, MICE, TOUCHPADS
# See https://wiki.hyprland.org/Configuring/Variables/#input
# -----------------------------------------------------
input {
    kb_layout = us
    kb_variant =
    kb_model =
    kb_options = ctrl:nocaps # Example: Caps Lock as Ctrl
    kb_rules =

    follow_mouse = 1 # Focus follows mouse

    touchpad {
        natural_scroll = yes
        disable_while_typing = true
        # clickfinger_behavior = true # enable click on tap
        # tap_button_map = lrm # left, right, middle
    }

    sensitivity = 0 # -1.0 - 1.0, 0 means no modification.
    accel_profile = flat # flat or adaptive
    force_no_accel = false # For mice primarily
}

# -----------------------------------------------------
# GENERAL SETTINGS
# See https://wiki.hyprland.org/Configuring/Variables/#general
# -----------------------------------------------------
general {
    gaps_in = 5
    gaps_out = 10
    border_size = 2
    # col.active_border = rgba(33ccffee) rgba(00ff99ee) 45deg
    col.active_border = rgba(ca9ee6ff) rgba(f2d5cfff) 45deg # Mauve + Pink
    col.inactive_border = rgba(414559ff) # Surface2

    layout = dwindle # master, dwindle

    # Please see https://wiki.hyprland.org/Configuring/Tearing/ before changing this variable!
    allow_tearing = false
}

# -----------------------------------------------------
# DECORATION
# See https://wiki.hyprland.org/Configuring/Variables/#decoration
# -----------------------------------------------------
decoration {
    rounding = 10

    blur {
        enabled = true
        size = 5
        passes = 2
        new_optimizations = true
        # xray = true # See through windows
        # noise = 0.015
        # contrast = 1.1
        # brightness = 1.0
    }
}

# -----------------------------------------------------
# ANIMATIONS
# See https://wiki.hyprland.org/Configuring/Animations/
# -----------------------------------------------------
animations {
    enabled = yes

    bezier = myBezier, 0.05, 0.9, 0.1, 1.05
    bezier = linear, 0.0, 0.0, 1.0, 1.0
    bezier = slow, 0, 0.75, 0.25, 1
    bezier = overshot, 0.05,0.9,0.1,1.1 # Default
    bezier = bounce, 0.05,0.9,0.1,1.2
    bezier = slurp, 0.05,0.9,0.1,1.4


    animation = windows, 1, 7, myBezier
    animation = windowsOut, 1, 7, myBezier, popin 80%
    animation = border, 1, 10, default
    animation = borderangle, 1, 8, default
    animation = fade, 1, 7, default
    animation = workspaces, 1, 6, default, slide
    # animation = workspaces, 1, 5, overshot, slidevert
}

# -----------------------------------------------------
# DWINDLE LAYOUT (if layout = dwindle)
# See https://wiki.hyprland.org/Configuring/Dwindle-Layout/
# -----------------------------------------------------
dwindle {
    pseudotile = yes # master switch for pseudotiling. Enabling is bound to mainMod + P in the keybinds section below
    preserve_split = yes # you probably want this
    force_split = 0 # 0: normal, 1: always split to the right, 2: always split to the bottom
    # no_gaps_when_only = false # Apply gaps even with one window
}

# -----------------------------------------------------
# MASTER LAYOUT (if layout = master)
# See https://wiki.hyprland.org/Configuring/Master-Layout/
# -----------------------------------------------------
master {
    # no_gaps_when_only = false
}

# -----------------------------------------------------
# GESTURES
# See https://wiki.hyprland.org/Configuring/Variables/#gestures
# -----------------------------------------------------
gestures {
    workspace_swipe = on
    workspace_swipe_fingers = 3
    workspace_swipe_distance = 300
    workspace_swipe_invert = true
    # workspace_swipe_min_speed_to_force = 30
    # workspace_swipe_cancel_ratio = 0.5
}

# -----------------------------------------------------
# MISCELLANEOUS
# See https://wiki.hyprland.org/Configuring/Variables/#misc
# -----------------------------------------------------
misc {
    disable_hyprland_logo = true
    disable_splash_rendering = true
    # force_default_wallpaper = 0 # -1 = no wallpaper, 0 = hyprland logo, >0 = path to file
    vfr = true # Variable Frame Rate
    vrr = 0 # 0: off, 1: on, 2: fullscreen only | Adaptive Sync (Freesync/GSync)
    enable_swallow = true
    swallow_regex = ^(kitty)$ # Example: kitty swallows child processes
    # focus_on_activate = false # Don't steal focus
}

# -----------------------------------------------------
# WINDOW RULES (Example: make F_irefox float)
# See https://wiki.hyprland.org/Configuring/Window-Rules/
# -----------------------------------------------------
# windowrule = float, ^(firefox)$
windowrule = float, ^(pavucontrol)$
windowrule = float, ^(blueman-manager)$
windowrule = float, ^(nm-connection-editor)$
windowrule = float, ^(org.kde.polkit-kde-authentication-agent-1)$
windowrule = float, title:^(Open File)$
windowrule = float, title:^(Save File)$
windowrule = float, title:^(Select Folder)$
windowrule = float, title:^(Volume Control)$
windowrule = float, title:^(Picture-in-Picture)$ # For Firefox PiP
windowrule = size 800 600, ^(pavucontrol)$
windowrule = idleinhibit focus, ^(mpv)$
windowrule = idleinhibit fullscreen, ^(firefox)$
windowrule = opacity 0.95, ^(kitty)$
windowrule = opacity 0.90,focused (kitty)
# windowrule = xwayland, gamescope # if using gamescope

# Layer rules for popups (e.g. wofi suggestions on top)
layerrule = blur, waybar
layerrule = ignorezero, waybar
layerrule = blur, wofi
layerrule = ignorezero, wofi
layerrule = blur, notifications # if using mako or dunst with a name
layerrule = ignorezero, notifications


# -----------------------------------------------------
# KEYBINDINGS
# See https://wiki.hyprland.org/Configuring/Binds/
# -----------------------------------------------------
$mainMod = SUPER # Sets "Windows" key as main modifier

# --- Applications ---
bind = $mainMod, RETURN, exec, kitty # Your terminal (kitty is in systemPackages)
bind = $mainMod, D, exec, wofi --show drun # App launcher (wofi is in systemPackages)
bind = $mainMod, E, exec, dolphin # File manager (dolphin is in systemPackages)
bind = $mainMod, B, exec, firefox # Web browser
bind = $mainMod SHIFT, C, exec, code # VSCode (ensure 'code' is in PATH)

# --- Window Management ---
bind = $mainMod, Q, killactive,
bind = $mainMod SHIFT, Q, exit, # Exit Hyprland (logout)
bind = $mainMod, F, fullscreen, 0 # Toggle fullscreen for active window
bind = $mainMod, SPACE, togglefloating, # Toggle floating for active window
bind = $mainMod, P, pseudo, # dwindle
bind = $mainMod, J, togglesplit, # dwindle

# Move focus with mainMod + arrow keys
bind = $mainMod, left, movefocus, l
bind = $mainMod, right, movefocus, r
bind = $mainMod, up, movefocus, u
bind = $mainMod, down, movefocus, d

# Move focus with mainMod + HJKL (vim-like)
bind = $mainMod, H, movefocus, l
bind = $mainMod, L, movefocus, r
bind = $mainMod, K, movefocus, u
bind = $mainMod, J, movefocus, d # Note: J is also togglesplit, be mindful or rebind one

# Swap windows with mainMod + SHIFT + arrow keys
bind = $mainMod SHIFT, left, swapwindow, l
bind = $mainMod SHIFT, right, swapwindow, r
bind = $mainMod SHIFT, up, swapwindow, u
bind = $mainMod SHIFT, down, swapwindow, d

# Swap windows with mainMod + SHIFT + HJKL (vim-like)
bind = $mainMod SHIFT, H, swapwindow, l
bind = $mainMod SHIFT, L, swapwindow, r
bind = $mainMod SHIFT, K, swapwindow, u
bind = $mainMod SHIFT, J, swapwindow, d

# Resize windows with mainMod + CTRL + arrow keys
bind = $mainMod CTRL, left, resizeactive, -20 0
bind = $mainMod CTRL, right, resizeactive, 20 0
bind = $mainMod CTRL, up, resizeactive, 0 -20
bind = $mainMod CTRL, down, resizeactive, 0 20

# --- Workspaces ---
# Switch workspaces with mainMod + [0-9]
bind = $mainMod, 1, workspace, 1
bind = $mainMod, 2, workspace, 2
bind = $mainMod, 3, workspace, 3
bind = $mainMod, 4, workspace, 4
bind = $mainMod, 5, workspace, 5
bind = $mainMod, 6, workspace, 6
bind = $mainMod, 7, workspace, 7
bind = $mainMod, 8, workspace, 8
bind = $mainMod, 9, workspace, 9
bind = $mainMod, 0, workspace, 10

# Move active window to a workspace with mainMod + SHIFT + [0-9]
bind = $mainMod SHIFT, 1, movetoworkspace, 1
bind = $mainMod SHIFT, 2, movetoworkspace, 2
bind = $mainMod SHIFT, 3, movetoworkspace, 3
bind = $mainMod SHIFT, 4, movetoworkspace, 4
bind = $mainMod SHIFT, 5, movetoworkspace, 5
bind = $mainMod SHIFT, 6, movetoworkspace, 6
bind = $mainMod SHIFT, 7, movetoworkspace, 7
bind = $mainMod SHIFT, 8, movetoworkspace, 8
bind = $mainMod SHIFT, 9, movetoworkspace, 9
bind = $mainMod SHIFT, 0, movetoworkspace, 10

# Scroll through existing workspaces with mainMod + scroll
bind = $mainMod, mouse_down, workspace, e+1
bind = $mainMod, mouse_up, workspace, e-1

# Move active window to workspace via scroll
bind = $mainMod SHIFT, mouse_down, movetoworkspace, e+1
bind = $mainMod SHIFT, mouse_up, movetoworkspace, e-1

# Special workspace (scratchpad)
bind = $mainMod, S, togglespecialworkspace, magic
bind = $mainMod SHIFT, S, movetoworkspace, special:magic

# --- Screenshots ---
bind = , PRINT, exec, grim -g "$(slurp -d)" - | wl-copy # Select area and copy
bind = $mainMod, PRINT, exec, grim -g "$(slurp -d)" ~/Pictures/Screenshots/$(date +'%Y-%m-%d_%H-%M-%S').png # Select area and save
bind = $mainMod SHIFT, PRINT, exec, grim ~/Pictures/Screenshots/$(date +'%Y-%m-%d_%H-%M-%S').png # Full screen save

# --- Clipboard ---
bind = $mainMod, V, exec, cliphist list | wofi --dmenu | cliphist decode | wl-copy # Open clipboard history with wofi

# --- System Controls (Brightness, Volume) ---
# These often use XF86 keys, which should work out of the box if your keyboard sends them.
# If not, you can bind them to other keys.
# Volume
binde =, XF86AudioRaiseVolume, exec, pactl set-sink-volume @DEFAULT_SINK@ +5% && ~/.config/hypr/scripts/volume_notify.sh
binde =, XF86AudioLowerVolume, exec, pactl set-sink-volume @DEFAULT_SINK@ -5% && ~/.config/hypr/scripts/volume_notify.sh
bind =, XF86AudioMute, exec, pactl set-sink-mute @DEFAULT_SINK@ toggle && ~/.config/hypr/scripts/volume_notify.sh
bind =, XF86AudioMicMute, exec, pactl set-source-mute @DEFAULT_SOURCE@ toggle
# Brightness
binde =, XF86MonBrightnessUp, exec, brightnessctl set +10% && ~/.config/hypr/scripts/brightness_notify.sh
binde =, XF86MonBrightnessDown, exec, brightnessctl set 10%- && ~/.config/hypr/scripts/brightness_notify.sh

# Media Player Controls
bind =, XF86AudioPlay, exec, playerctl play-pause
bind =, XF86AudioPause, exec, playerctl play-pause # Some keyboards send Pause instead of Play/Pause
bind =, XF86AudioNext, exec, playerctl next
bind =, XF86AudioPrev, exec, playerctl previous
bind =, XF86AudioStop, exec, playerctl stop

# --- Locking and Power Menu ---
bind = $mainMod, L, exec, hyprlock # Lock screen
bind = $mainMod ALT, L, exec, wlogout -p layer-shell # Logout menu (wlogout)

# Example: Use SUPER + SHIFT + E for a power menu (using wlogout)
# bind = $mainMod SHIFT, E, exec, wlogout # Ensure wlogout is installed

# --- Resize mode ---
bind = $mainMod, R, submap, resize
submap = resize
binde =,right,resizeactive,10 0
binde =,left,resizeactive,-10 0
binde =,up,resizeactive,0 -10
binde =,down,resizeactive,0 10
bind=,escape,submap,reset
submap = reset

# Pass through mainMod + F1-F12 to virtual consoles
# bind = $mainMod, F1, workspace, name:testing
# ... (Uncomment and customize if needed) 